.area _ADC_MAIN_DATA_(ADC_MAIN_DATA)
.even
ADC_BusyFlag:
	.ds 2
ADC_last_channel:
	.ds 2
	
;.area _ADC_MAIN_CODE_(ADC_MAIN_CODE)
.area _TASK_INIT_CODE_(TASK_INIT_CODE)
_ADC_init::
	PUSH R0
	MOV	R0,#0
	MOVX ADC_BusyFlag,R0
	MOV	R0,#0xFFFF
	MOVX ADC_last_channel,R0
	POP R0
	RETS
	
.area _ADC_MAIN_CODE_(ADC_MAIN_CODE)
_Get_ADCValue::
	LINK #1
	PUSH R1
		
    MOVX R0,ADC_BusyFlag
    CMP R0,#0
    AJMP IF_NE,$IsBusy
    MOV	R0,#(-1)
    MOVX ADC_BusyFlag,R0

	MOV R0,[FP+#(6)]		;Cnt = Chx
	AND R0,#7
	SL R0,#3
	OR R0,#0x8000
	MOVX ADCCON,R0

	MOV R0,#0
$LOOP:
	BSET ADCCON.0
$WAIT_KICKOFF:
	JB	ADCCON.0, $WAIT_KICKOFF			
	CMPI1 R0,#10
	AJMP IF_UL,$LOOP

	MOV R0,#0
$LOOP2:
	CMPI1 R0,#10
	AJMP IF_UL,$LOOP2

	MOVX R0,ADCD
	SR R0,#6
    MOV	R1,#0
    MOVX ADC_BusyFlag,R1
$IsBusy:
	POP R1
	UNLINK	
	RETS	
